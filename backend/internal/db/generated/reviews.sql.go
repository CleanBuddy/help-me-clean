// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: reviews.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const countAllReviews = `-- name: CountAllReviews :one
SELECT COUNT(*) FROM reviews
`

func (q *Queries) CountAllReviews(ctx context.Context) (int64, error) {
	row := q.db.QueryRow(ctx, countAllReviews)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countReviewsByCleanerID = `-- name: CountReviewsByCleanerID :one
SELECT COUNT(*) FROM reviews WHERE reviewed_cleaner_id = $1
`

func (q *Queries) CountReviewsByCleanerID(ctx context.Context, reviewedCleanerID pgtype.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, countReviewsByCleanerID, reviewedCleanerID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createReview = `-- name: CreateReview :one
INSERT INTO reviews (booking_id, reviewer_user_id, reviewed_user_id, reviewed_cleaner_id, rating, comment, review_type)
VALUES ($1, $2, $3, $4, $5, $6, $7)
RETURNING id, booking_id, reviewer_user_id, reviewed_user_id, reviewed_cleaner_id, rating, comment, review_type, created_at
`

type CreateReviewParams struct {
	BookingID         pgtype.UUID `json:"booking_id"`
	ReviewerUserID    pgtype.UUID `json:"reviewer_user_id"`
	ReviewedUserID    pgtype.UUID `json:"reviewed_user_id"`
	ReviewedCleanerID pgtype.UUID `json:"reviewed_cleaner_id"`
	Rating            int32       `json:"rating"`
	Comment           pgtype.Text `json:"comment"`
	ReviewType        string      `json:"review_type"`
}

func (q *Queries) CreateReview(ctx context.Context, arg CreateReviewParams) (Review, error) {
	row := q.db.QueryRow(ctx, createReview,
		arg.BookingID,
		arg.ReviewerUserID,
		arg.ReviewedUserID,
		arg.ReviewedCleanerID,
		arg.Rating,
		arg.Comment,
		arg.ReviewType,
	)
	var i Review
	err := row.Scan(
		&i.ID,
		&i.BookingID,
		&i.ReviewerUserID,
		&i.ReviewedUserID,
		&i.ReviewedCleanerID,
		&i.Rating,
		&i.Comment,
		&i.ReviewType,
		&i.CreatedAt,
	)
	return i, err
}

const deleteReview = `-- name: DeleteReview :exec
DELETE FROM reviews WHERE id = $1
`

func (q *Queries) DeleteReview(ctx context.Context, id pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deleteReview, id)
	return err
}

const getAverageCleanerRating = `-- name: GetAverageCleanerRating :one
SELECT COALESCE(AVG(rating), 0)::DECIMAL(3,2) AS avg_rating FROM reviews WHERE reviewed_cleaner_id = $1
`

func (q *Queries) GetAverageCleanerRating(ctx context.Context, reviewedCleanerID pgtype.UUID) (pgtype.Numeric, error) {
	row := q.db.QueryRow(ctx, getAverageCleanerRating, reviewedCleanerID)
	var avg_rating pgtype.Numeric
	err := row.Scan(&avg_rating)
	return avg_rating, err
}

const getReviewByBookingID = `-- name: GetReviewByBookingID :one
SELECT id, booking_id, reviewer_user_id, reviewed_user_id, reviewed_cleaner_id, rating, comment, review_type, created_at FROM reviews WHERE booking_id = $1
`

func (q *Queries) GetReviewByBookingID(ctx context.Context, bookingID pgtype.UUID) (Review, error) {
	row := q.db.QueryRow(ctx, getReviewByBookingID, bookingID)
	var i Review
	err := row.Scan(
		&i.ID,
		&i.BookingID,
		&i.ReviewerUserID,
		&i.ReviewedUserID,
		&i.ReviewedCleanerID,
		&i.Rating,
		&i.Comment,
		&i.ReviewType,
		&i.CreatedAt,
	)
	return i, err
}

const listAllReviews = `-- name: ListAllReviews :many
SELECT id, booking_id, reviewer_user_id, reviewed_user_id, reviewed_cleaner_id, rating, comment, review_type, created_at FROM reviews ORDER BY created_at DESC LIMIT $1 OFFSET $2
`

type ListAllReviewsParams struct {
	Limit  int32 `json:"limit"`
	Offset int32 `json:"offset"`
}

func (q *Queries) ListAllReviews(ctx context.Context, arg ListAllReviewsParams) ([]Review, error) {
	rows, err := q.db.Query(ctx, listAllReviews, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Review
	for rows.Next() {
		var i Review
		if err := rows.Scan(
			&i.ID,
			&i.BookingID,
			&i.ReviewerUserID,
			&i.ReviewedUserID,
			&i.ReviewedCleanerID,
			&i.Rating,
			&i.Comment,
			&i.ReviewType,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listReviewsByCleanerID = `-- name: ListReviewsByCleanerID :many
SELECT id, booking_id, reviewer_user_id, reviewed_user_id, reviewed_cleaner_id, rating, comment, review_type, created_at FROM reviews WHERE reviewed_cleaner_id = $1 ORDER BY created_at DESC LIMIT $2 OFFSET $3
`

type ListReviewsByCleanerIDParams struct {
	ReviewedCleanerID pgtype.UUID `json:"reviewed_cleaner_id"`
	Limit             int32       `json:"limit"`
	Offset            int32       `json:"offset"`
}

func (q *Queries) ListReviewsByCleanerID(ctx context.Context, arg ListReviewsByCleanerIDParams) ([]Review, error) {
	rows, err := q.db.Query(ctx, listReviewsByCleanerID, arg.ReviewedCleanerID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Review
	for rows.Next() {
		var i Review
		if err := rows.Scan(
			&i.ID,
			&i.BookingID,
			&i.ReviewerUserID,
			&i.ReviewedUserID,
			&i.ReviewedCleanerID,
			&i.Rating,
			&i.Comment,
			&i.ReviewType,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
